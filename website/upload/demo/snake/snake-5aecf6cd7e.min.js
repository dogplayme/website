function Snake(){this.manager={canvas:{width:0,computedWidth:0},food:{x:0,y:0,width:1,computedWidth:0,color:"black"},snake:{body:[],direction:[],currentDirection:39,color:"black",width:1,computedWidth:0},wall:{color:"black",width:1,computedWidth:0,body:[]},game:{score:0,perPixel:10,speed:50,speedPlusTime:3,mutiple:.85,isWallExisted:!1,isFoodChangeable:!1,foodChangeSpeed:3e3,isDirectionChangeable:!0}},"function"!=typeof this.initialGame&&(Snake.prototype.initialGame=function(e){var t=this.manager.game.perPixel;this.manager.canvas.width=e.getAttribute("width"),this.manager.canvas.computedWidth=this.manager.canvas.width/t,this.manager.food.computedWidth=this.manager.food.width*t,this.manager.snake.computedWidth=this.manager.snake.width*t,this.manager.wall.computedWidth=this.manager.wall.width*t,this.manager.game.isWallExisted=Boolean(parseInt(localStorage.getItem("isWallExisted"))),this.manager.game.isFoodChangeable=Boolean(parseInt(localStorage.getItem("isFoodChangeable"))),this.manager.game.speed=parseInt(localStorage.getItem("speed")),t=null}),"function"!=typeof this.buildWall&&(Snake.prototype.buildWall=function(e){e.save(),e.strokeStyle=this.manager.wall.color,e.lineWidth=this.manager.wall.computedWidth,e.strokeRect(this.manager.wall.computedWidth/2,this.manager.wall.computedWidth/2,this.manager.canvas.width-this.manager.wall.computedWidth,this.manager.canvas.width-this.manager.wall.computedWidth),e.stroke(),e.restore()}),"function"!=typeof this.updateFood&&(Snake.prototype.updateFood=function(){var e=[],t=this.manager.snake.body,a=this.manager.wall,o=this.manager.canvas,n=this.manager.food;do e=[],e.push(tools.getMutipleFloor(tools.randomArea(a.computedWidth,o.width-1-a.computedWidth),n.computedWidth)),e.push(tools.getMutipleFloor(tools.randomArea(a.computedWidth,o.width-1-a.computedWidth),n.computedWidth));while(tools.isArrayInArrayOrNot(e,t));n.x=e[0],n.y=e[1],e=t=a=o=n=null}),"function"!=typeof this.deliverFood&&(Snake.prototype.deliverFood=function(e){var t=this.manager.food;e.save(),e.beginPath(),e.fillStyle=t.color,e.rect(t.x,t.y,t.computedWidth,t.computedWidth),e.fill(),e.stroke(),e.restore(),t=null}),"function"!=typeof this.dropSnake&&(Snake.prototype.dropSnake=function(e,t){for(var a=this.manager.canvas,o=(this.manager.game,this.manager.snake),n=0;n<e;n++){var i=[tools.getMutipleFloor(a.width/2,o.computedWidth)-n*o.computedWidth,tools.getMutipleFloor(a.width/2,o.computedWidth)];this.manager.snake.body.push(i),this.manager.snake.direction.push(o.currentDirection)}this.showSnake(t)}),"function"!=typeof this.updateSnake&&(Snake.prototype.updateSnake=function(e){function t(e,t){var o;switch(e){case 38:o=t.pop()-a.computedWidth,t.push(o);break;case 39:o=t.shift()+a.computedWidth,t.unshift(o);break;case 40:o=t.pop()+a.computedWidth,t.push(o);break;case 37:o=t.shift()-a.computedWidth,t.unshift(o)}}var a=this.manager.snake,o=a.body[0].concat();if(t(a.currentDirection,o),o[0]==this.manager.food.x&&o[1]==this.manager.food.y){if(a.body.unshift(o),a.direction.unshift(a.currentDirection),this.manager.game.score+=1,this.updateScore(e),this.manager.game.isFoodChangeable){clearInterval(foodTimer);var n=this;foodTimer=setInterval(function(){n.updateFood()},n.manager.game.foodChangeSpeed)}return!0}a.direction.pop(),a.direction.unshift(a.currentDirection);for(var i in a.direction)if(t(a.direction[i],a.body[i]),!this.manager.game.isWallExisted){var r=this.manager.wall,d=this.manager.canvas;a.body[i][0]<r.computedWidth?a.body[i][0]=d.width-r.computedWidth:a.body[i][0]>=d.width-r.computedWidth&&(a.body[i][0]=r.computedWidth),a.body[i][1]<r.computedWidth?a.body[i][1]=d.width-r.computedWidth:a.body[i][1]>=d.width-r.computedWidth&&(a.body[i][1]=r.computedWidth),r=d=null}a=o=null}),"function"!=typeof this.showSnake&&(Snake.prototype.showSnake=function(e){var t=this.manager.snake;e.save(),e.beginPath(),e.fillStyle=t.color;for(var a in t.body)e.rect(t.body[a][0],t.body[a][1],t.computedWidth,t.computedWidth);e.fill(),e.stroke(),e.restore(),t=null}),"function"!=typeof this.checkAccident&&(Snake.prototype.checkAccident=function(){var e=this.manager.snake.body.concat(),t=e.shift();if(tools.isArrayInArrayOrNot(t,e))return!0;if(this.manager.game.isWallExisted){var a=this.manager.wall,o=this.manager.canvas,n=function(){return t[0]<a.computedWidth||(t[0]>o.width-1-a.computedWidth||(t[1]<a.width||t[1]>o.width-1-a.computedWidth))}();if(n)return!0}return!1}),"function"!=typeof this.addChangeDirectionHandle&&(Snake.prototype.addChangeDirectionHandle=function(){var e=this;EventUtil.addHandler(document,"keydown",function(t){e.manager.game.isDirectionChangeable&&(e.manager.game.isDirectionChangeable=!1,t=EventUtil.getEvent(t),e.manager.snake.currentDirection=function(a){switch(a){case 37:return EventUtil.preventDefault(t),39==e.manager.snake.currentDirection?39:37;case 38:return EventUtil.preventDefault(t),40==e.manager.snake.currentDirection?40:38;case 39:return EventUtil.preventDefault(t),37==e.manager.snake.currentDirection?37:39;case 40:return EventUtil.preventDefault(t),38==e.manager.snake.currentDirection?38:40}}(t.keyCode))})}),"function"!=typeof this.go&&(Snake.prototype.go=function(e,t){var a=this,o=this.manager.wall,n=this.manager.canvas;this.manager.game.isFoodChangeable&&(foodTimer=setInterval(function(){a.updateFood()},a.manager.game.foodChangeSpeed));var i=setInterval(function(){a.manager.game.isDirectionChangeable=!0,e.clearRect(o.computedWidth,o.computedWidth,n.width-2*o.computedWidth,n.width-2*o.computedWidth),a.deliverFood(e),a.updateSnake(t)&&a.updateFood(),a.showSnake(e),a.checkAccident()&&(clearInterval(i),a.manager.game.isFoodChangeable&&clearInterval(foodTimer),a.manager.game.score>localStorage.getItem("highestScore")&&localStorage.setItem("highestScore",a.manager.game.score),setTimeout(function(){location.reload()},1500))},this.manager.game.speed)}),"function"!=typeof this.updateScore&&(Snake.prototype.updateScore=function(e){e.innerText=this.manager.game.score}),"function"!=typeof this.checkScore&&(Snake.prototype.checkScore=function(){if(0!=this.manager.game.score&&this.manager.game.score%this.manager.game.speedPlusTime==0)return this.manager.game.isSpeedPlus=!0,!0}),"function"!=typeof this.updateSpeed&&(Snake.prototype.updateSpeed=function(){this.manager.game.speed*=this.manager.game.mutiple})}var tools={isArrayInArrayOrNot:function(e,t){if(e.length!=t[0].length)return!1;for(var a in t){var o=!0;for(var n in e)o=e[n]==t[a][n]&&o;if(o)return!0}return!1},randomArea:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)},getMutipleFloor:function(e,t){return Math.floor(e/t)*t}},EventUtil={addHandler:function(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent?e.attachEvent("on"+t,a):e["on"+t]=a},getEvent:function(e){return e?e:window.event},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},getCharCode:function(e){return"number"==typeof e.charCode?e.charCode:e.keyCode}};window.onload=function(){function e(){document.getElementsByName("isWallExisted")[0].checked?localStorage.setItem("isWallExisted",document.getElementsByName("isWallExisted")[0].value):localStorage.setItem("isWallExisted",document.getElementsByName("isWallExisted")[1].value),document.getElementsByName("isFoodChangeable")[0].checked?localStorage.setItem("isFoodChangeable",document.getElementsByName("isFoodChangeable")[0].value):localStorage.setItem("isFoodChangeable",document.getElementsByName("isFoodChangeable")[1].value),document.getElementsByName("speed")[0].checked?localStorage.setItem("speed",document.getElementsByName("speed")[0].value):localStorage.setItem("speed",document.getElementsByName("speed")[1].value)}document.getElementById("highestScore").innerText=localStorage.getItem("highestScore")?localStorage.getItem("highestScore"):0;var t=document.getElementById("go");t.focus(),EventUtil.addHandler(t,"click",function(){document.getElementsByClassName("setting")[0].style.visibility="hidden",e();var t=document.getElementById("drawing");if(t.getContext){var a=new Snake,o=t.getContext("2d"),n=document.getElementById("score");a.initialGame(t),a.buildWall(o),a.dropSnake(8,o),a.updateFood(),a.deliverFood(o),a.addChangeDirectionHandle(),a.updateScore(n),a.go(o,n)}})};